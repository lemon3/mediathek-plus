// ==UserScript==
// @name         ORF DL
// @namespace    https://github.com/lemon3/
// @version      0.5.2
// @description  orf tvthek video download helper
// @author       lemon3
// @match        https://*.tvthek.orf.at/*
// @icon         https://raw.githubusercontent.com/lemon3/orfdl/main/_assets/dl.svg
// @grant        none
// @run-at       document-end
// @license      MIT
// @copyright    lemon3
// @homepage     https://github.com/lemon3/orfdl
// @updateURL    https://raw.githubusercontent.com/lemon3/orfdl/main/dist/orfdl.meta.js
// @downloadURL  https://raw.githubusercontent.com/lemon3/orfdl/main/dist/orfdl.user.js
// ==/UserScript==

!function(){"use strict";var n={406:function(n,e,t){var r=t(815),o=t.n(r),i=t(383),a=t.n(i),c=t(277),l=t.n(c),s=new URL(t(297),t.b),u=new URL(t(446),t.b),d=new URL(t(554),t.b),p=a()(o()),f=l()(s),g=l()(u),v=l()(d);p.push([n.id,"#l3-7086 {\n  --color-1: #000;\n  --color-2: #222;\n  --color-3: #90a8c2;\n  --color-4: #c9c9c9;\n  --color-5: #222222;\n  --min-font: 12px;\n}\n\n#l3-7086 {\n  position: fixed;\n  top: 0;\n  left: 0;\n  z-index: 99999;\n  font-family: Arial, 'Helvetica Neue', Helvetica, sans-serif;\n  color: var(--color-4);\n}\n\n#l3-7086 .l3-7086-info {\n  font-size: var(--min-font);\n}\n\n#l3-7086-body .l3-7086-info {\n  padding-left: 15px;\n  padding-right: 15px;\n}\n\n#l3-7086-clear {\n  color: var(--color-1);\n  background-color: var(--color-3);\n  width: 32px;\n  height: 38px;\n  text-align: center;\n  box-sizing: border-box;\n  padding: 0;\n  flex: none;\n  text-align: center;\n  justify-content: center;\n  padding: 0.5em;\n  cursor: pointer;\n}\n\n#l3-7086-header {\n  width: 100%;\n  padding: 15px;\n}\n\n#l3-7086-filter {\n  display: flex;\n  align-items: stretch;\n  margin-top: 0.5em;\n}\n\n#l3-7086-content {\n  max-height: 260px;\n  overflow: scroll;\n}\n\n#l3-7086-close {\n  z-index: 999999;\n  position: absolute;\n  top: 19px;\n  left: 15px;\n  padding: 0;\n  background-image: url("+f+");\n  background-repeat: no-repeat;\n  width: 38px;\n  height: 38px;\n  background-size: 20px;\n  background-color: var(--color-1);\n  border-radius: 50%;\n  background-position: center center;\n  box-shadow: 0 2px 12px -3px rgba(255, 255, 255, 0.8);\n  cursor: pointer;\n}\n\n#l3-7086-close.open {\n  background-image: url("+g+");\n}\n\n#l3-7086-field {\n  font-size: 16px;\n  touch-action: none;\n  padding: 8px;\n  height: 38px;\n  border: 0;\n  border-radius: 0;\n  color: var(--color-2);\n  width: 100%;\n}\n\n#l3-7086-field:focus {\n  outline: none;\n}\n\n#l3-7086-box {\n  z-index: 999999;\n  box-sizing: border-box;\n  margin: 0px;\n  top: 64px;\n  max-width: 280px;\n  width: 280px;\n  background-color: var(--color-1);\n  transform: translateX(-100%);\n  position: relative;\n  transition: transform 0.1s ease-out;\n  /* box-shadow: 0 8px 15px -6px rgba(255, 255, 255, 0.3); */\n  border: 1px solid var(--color-5);\n}\n\n#l3-7086-box.open {\n  transform: translateX(0);\n  transition: transform 0.2s ease-out;\n}\n\n#l3-7086 .l3-7086-shareBtn {\n  background-image: url("+v+");\n  width: 32px;\n  height: 32px;\n  background-color: var(--color-3);\n  display: flex;\n  background-size: 80%;\n  background-repeat: no-repeat;\n  background-position: center center;\n  flex: none;\n  border: none;\n}\n\n#l3-7086 .l3-7086-result {\n  display: flex;\n  flex-flow: row wrap;\n  padding: 1em;\n}\n\n#l3-7086 .l3-7086-result:nth-child(odd) {\n  background-color: var(--color-5);\n}\n\n#l3-7086 .l3-7086-bar {\n  width: 100%;\n  flex: 1 1 100%;\n  font-size: var(--min-font);\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 0.5em;\n}\n\n#l3-7086 .l3-7086-title {\n  display: flex;\n  padding: 0.5em 0.5em 0.5em 0;\n  line-height: 1.4em;\n}\n\n/* textarea */\n/* #l3-7086 .l3-7086-ta {\n  border: none;\n  border-radius: 0;\n  padding: 0.5em;\n  font-size: 12px;\n  line-height: 1.1em;\n  box-sizing: border-box;\n  flex: 0 1 40% !important;\n  resize: none;\n  touch-action: none;\n} */\n\n#l3-7086 img.active {\n  box-shadow: 0 0 0 2px rgb(255, 255, 84);\n  filter: brightness(1.2);\n}\n\n#l3-7086-footer {\n  text-align: right;\n}\n",""]),e.Z=p},383:function(n){n.exports=function(n){var e=[];return e.toString=function(){return this.map((function(e){var t="",r=void 0!==e[5];return e[4]&&(t+="@supports (".concat(e[4],") {")),e[2]&&(t+="@media ".concat(e[2]," {")),r&&(t+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),t+=n(e),r&&(t+="}"),e[2]&&(t+="}"),e[4]&&(t+="}"),t})).join("")},e.i=function(n,t,r,o,i){"string"==typeof n&&(n=[[null,n,void 0]]);var a={};if(r)for(var c=0;c<this.length;c++){var l=this[c][0];null!=l&&(a[l]=!0)}for(var s=0;s<n.length;s++){var u=[].concat(n[s]);r&&a[u[0]]||(void 0!==i&&(void 0===u[5]||(u[1]="@layer".concat(u[5].length>0?" ".concat(u[5]):""," {").concat(u[1],"}")),u[5]=i),t&&(u[2]?(u[1]="@media ".concat(u[2]," {").concat(u[1],"}"),u[2]=t):u[2]=t),o&&(u[4]?(u[1]="@supports (".concat(u[4],") {").concat(u[1],"}"),u[4]=o):u[4]="".concat(o)),e.push(u))}},e}},277:function(n){n.exports=function(n,e){return e||(e={}),n?(n=String(n.__esModule?n.default:n),/^['"].*['"]$/.test(n)&&(n=n.slice(1,-1)),e.hash&&(n+=e.hash),/["'() \t\n]|(%20)/.test(n)||e.needQuotes?'"'.concat(n.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):n):n}},815:function(n){n.exports=function(n){return n[1]}},554:function(n){n.exports="data:image/svg+xml;base64,PHN2ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyNTYgMjU2IiB2aWV3Qm94PSIwIDAgMjU2IDI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSIjMWQxZDFiIj48cGF0aCBkPSJtMjA0LjMgMjQyLjdoLTE1Mi42Yy00LjEgMC03LjUtMy40LTcuNS03LjV2LTEyOC4xYzAtNC4xIDMuNC03LjUgNy41LTcuNWg1MC4xYzQuMSAwIDcuNSAzLjQgNy41IDcuNXMtMy40IDcuNS03LjUgNy41aC00Mi42djExMy4yaDEzNy42di0xMTMuMmgtNDIuNmMtNC4xIDAtNy41LTMuNC03LjUtNy41czMuNC03LjUgNy41LTcuNWg1MC4xYzQuMSAwIDcuNSAzLjQgNy41IDcuNXYxMjguMmMwIDQuMS0zLjQgNy40LTcuNSA3LjR6Ii8+PHBhdGggZD0ibTEyOCAxNzguM2MtNC4xIDAtNy41LTMuNC03LjUtNy41di0xMzIuN2wtMzUuMiAzNS4yYy0yLjkgMi45LTcuNyAyLjktMTAuNiAwcy0yLjktNy43IDAtMTAuNmw0Ny45LTQ3LjljLjEtLjEuMy0uMy40LS40IDEuMi0xIDIuNi0xLjYgNC0xLjguNS0uMSAxLS4xIDEuNCAwIDEuNy4xIDMuNS44IDQuOCAyLjJsNDggNDhjMS41IDEuNSAyLjIgMy40IDIuMiA1LjNzLS43IDMuOC0yLjIgNS4zYy0yLjkgMi45LTcuNyAyLjktMTAuNiAwbC0zNS4yLTM1LjJ2MTMyLjdjLjEgNC0zLjMgNy40LTcuNCA3LjR6Ii8+PC9nPjwvc3ZnPg=="},297:function(n){n.exports="data:image/svg+xml;base64,PHN2ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyNTYgMjU2IiB2aWV3Qm94PSIwIDAgMjU2IDI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48ZyBmaWxsPSIjZmZmIj48cGF0aCBkPSJtMjQzLjIgMTE5LjZ2MTYuOGgtMjMwLjR2LTE2Ljh6Ii8+PHBhdGggZD0ibTI0My4yIDE3NC42djE2LjhoLTIzMC40di0xNi44eiIvPjxwYXRoIGQ9Im0yNDMuMiA2NC42djE2LjhoLTIzMC40di0xNi44eiIvPjwvZz48L3N2Zz4="},446:function(n){n.exports="data:image/svg+xml;base64,PHN2ZyBlbmFibGUtYmFja2dyb3VuZD0ibmV3IDAgMCAyNTYgMjU2IiB2aWV3Qm94PSIwIDAgMjU2IDI1NiIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cGF0aCBkPSJtMjQ2LjUgMjM0LjctMTA2LjctMTA2LjcgMTA2LjctMTA2LjctMTEuOC0xMS45LTEwNi43IDEwNi43LTEwNi43LTEwNi42LTExLjggMTEuOSAxMDYuNiAxMDYuNi0xMDYuNiAxMDYuNiAxMS44IDExLjkgMTA2LjctMTA2LjYgMTA2LjcgMTA2Ljd6IiBmaWxsPSIjZmZmIi8+PC9zdmc+"}},e={};function t(r){var o=e[r];if(void 0!==o)return o.exports;var i=e[r]={id:r,exports:{}};return n[r](i,i.exports,t),i.exports}t.m=n,t.n=function(n){var e=n&&n.__esModule?function(){return n.default}:function(){return n};return t.d(e,{a:e}),e},t.d=function(n,e){for(var r in e)t.o(e,r)&&!t.o(n,r)&&Object.defineProperty(n,r,{enumerable:!0,get:e[r]})},t.o=function(n,e){return Object.prototype.hasOwnProperty.call(n,e)},t.b=document.baseURI||self.location.href,function(){var n=t(406);function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},e(n)}function r(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable}))),t.push.apply(t,r)}return t}function o(n){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){i(n,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(n,e,Object.getOwnPropertyDescriptor(t,e))}))}return n}function i(n,e,t){return(e=c(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function a(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,c(r.key),r)}}function c(n){var t=function(n,t){if("object"!==e(n)||null===n)return n;var r=n[Symbol.toPrimitive];if(void 0!==r){var o=r.call(n,t||"default");if("object"!==e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(n)}(n,"string");return"symbol"===e(t)?t:String(t)}var l,s=function(n,e,t){return function(n,e,t){if(e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.setAttribute(r,e[r]);if(t)for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(n.style[o]=t[o]);return n}(document.createElement(n),e,t)},u=function(){function n(){!function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}(this,n)}var e,t,r;return e=n,(t=[{key:"get",value:function(n,e){var t=localStorage.getItem(n);if(!t)return!1;var r=JSON.parse(t);return e?r[e]:r}},{key:"set",value:function(n,e){var t=o(o({},this.get(n)||{}),e),r=JSON.stringify(t);localStorage.setItem(n,r)}}])&&a(e.prototype,t),r&&a(e,r),Object.defineProperty(e,"prototype",{writable:!1}),n}(),d=((l=document.createElement("iframe")).src="about:blank",l.style.display="none",document.body.appendChild(l),l.contentWindow.console);window.cons=d;var p,f,g,v,y,m,b,h,L,j,x,M="dl-app",w=!0,I="",N=n.Z.toString(),T=[],A="",D=function(n){var e=n.filter((function(n){return"Q8C"===n.quality&&"hls"===n.delivery}));return 0===e.length?null:e[0].src},S=function(){var n,e,t=[];window.jsb&&window.jsb.last_event_values&&window.jsb.last_event_values["VideoPlaylist::INITIALIZED"]?n=window.jsb.last_event_values["VideoPlaylist::INITIALIZED"]:document.querySelectorAll(".player_viewport [data-jsb]").forEach((function(e){if(e.dataset&&e.dataset.jsb){var t=JSON.parse(e.dataset.jsb);if(t.playlist)return void(n=t)}}));if(!n)return t;e=n.playlist;var r,o,i,a=n.drm;o=e.preview_image_url,i=e.title;var c=e.gapless_video;if(c){var l=D(c.sources);l&&(r=l)}else{for(var s=e.videos,u=[],d=0;d<s.length;d++){var p=s[d],f=D(p.sources);f&&(r=f,u.push(r))}r="",u.forEach((function(n,e){r+="yt-dlp "+n+' -o "'+i+"_"+(e+1)+'.mp4" && '})),r&&(r=r.slice(0,-4))}var g=function(n){if(!n)return new Date;var e=n.match(/(\d{4})[_-](\d\d)[_-](\d\d)[_-](\d{4})/);if(!e)return new Date;var t=e[1],r=e[2],o=e[3],i=e[4].slice(0,-2)+":"+e[4].slice(2);return new Date("".concat(t,"-").concat(r,"-").concat(o," ").concat(i))}(e.videos[0].sources[0].src);return t.push({type:"all",title:i,drm:a,date:g,link:r,img:o}),r="",e.videos.forEach((function(n){var e=D(n.sources);e&&(r=e),t.push({type:"single",title:n.title,drm:a,date:g,link:r,img:n.preview_image_url})})),t},E=function(n){return("0"+n).slice(-(arguments.length>1&&void 0!==arguments[1]?arguments[1]:2))},C=function(n){var e=n.target;(x&&x.classList.remove("active"),"img"===e.nodeName.toLocaleLowerCase()&&e.dataset.drm&&"false"===e.dataset.drm)?k(n)&&(e.classList.add("active"),x=e):"button"===e.nodeName.toLocaleLowerCase()&&void 0!==e.dataset.share&&z(n)},k=function(n){var e=n.target.nextSibling;if(e.select(),navigator.clipboard){var t=e.innerHTML;return navigator.clipboard.writeText(t).then((function(){return console.log("successful")}),(function(n){return console.log("error",n)}))}return document.execCommand("copy")},z=function(n){if(!navigator.share)return!1;var e=n.target,t=e.dataset.sharetitle,r=e.dataset.shareurl;navigator.share({title:t,url:r}).then((function(){return console.log("successful share")})).catch((function(n){return console.log("error sharing:",n)}))},P=function(n){if(!n.length)return null;for(var e=new DocumentFragment,t=n.length-1;t>=0;t--){var r=n[t],o=s("div",{class:"l3-7086-result"}),i=s("div",{class:"l3-7086-bar"}),a=s("div",{class:"l3-7086-title"});a.innerHTML=r.title,i.append(a);var c=s("textarea",{class:"l3-7086-ta",disabled:"true"},{position:"absolute",left:"-999em",opacity:0}),l=s("img",{src:r.img,width:"150"},{flex:"auto"});l.dataset.drm=null!==r.drm&&r.drm;var u=void 0;if(!r.drm){var d=r.date.getFullYear(),p=E(+r.date.getMonth()+1),f=E(r.date.getDate()),g=E(r.date.getHours()),v=E(r.date.getMinutes()),y="".concat(d,"-").concat(p,"-").concat(f),b="".concat(g).concat(v),h=r.title.toLowerCase().replaceAll('"',"");h.replaceAll("'","");var L="".concat(y,"_").concat(b,"_").concat(h,".mp4");u="yt-dlp ".concat(r.link," -o '").concat(L,"'");var j=s("button",{class:"l3-7086-shareBtn"});j.dataset.share=!0,j.dataset.shareurl=r.link,i.append(j)}c.innerHTML=u,o.append(i),o.append(l),o.append(c),e.append(o)}m.append(e)},O=function(){w?(y.classList.remove("open"),L.classList.remove("open"),f=setTimeout((function(){y.style.display="none",w=!1,p.set(M,{open:w}),clearTimeout(f)}),100)):(y.style.display="block",f=setTimeout((function(){y.classList.add("open"),L.classList.add("open"),h&&h.focus(),w=!0,p.set(M,{open:w}),clearTimeout(f)}),1))},Z=function(n){if(A!==n){var e=""===n?[]:function(n){if(""===n)return T;var e="*"===n?"all":"single";return T.filter((function(t){return t.type===e&&("*"===n||t.title.toLowerCase().match(n.replaceAll("*",".*").toLowerCase()))}))}(n);m.innerHTML="",b.style.display=e.length?"block":"none",P(e),p.set(M,{search:n}),A=n}},_=function(){h.value="",h.dispatchEvent(new Event("input")),h.focus()},Y=function(n){if(n)return j.style.display="none",void(v=!1);v||(j.style.display="flex",v=!0)},H=function(n){var e=n.currentTarget.value;Z(e),Y(""===e)};!function(){if(g)return!1;var n=(p=new u).get(M);if(n&&(void 0!==n.search&&(I=n.search),void 0!==n.open&&(w=n.open)),g=!0,(T=S()).length)if(function(){var n=T.length-1,e=1===n,t=s("div",{id:"l3-7086"}),r=s("div",{id:"l3-7086-body"});if(y=s("div",{id:"l3-7086-box"}),!e){var o=s("div",{id:"l3-7086-header"}),i=s("div",{class:"l3-7086-info"});i.innerHTML="Number of Videos: ".concat(n),o.append(i);var a=s("div",{id:"l3-7086-filter"});h=s("input",{type:"text",id:"l3-7086-field",name:"fake_user[name]",value:"",autocomplete:"new-password",spellcheck:"false","aria-autocomplete":"none",placeholder:"filter videos by name ..."});var c=s("div",{class:"l3-7086-info"});c.innerHTML="Type * to see the full episode/broadcast",(j=document.createElement("div")).id="l3-7086-clear",j.innerHTML="X",Y(!0),a.append(h),a.append(j),o.append(a),o.append(c),j.addEventListener("click",_,!1),h.addEventListener("input",H,!1),y.append(o)}(L=s("div",{id:"l3-7086-close"})).addEventListener("click",O),m=s("div",{id:"l3-7086-content"}),(b=s("div",{class:"l3-7086-info"})).innerHTML="Click on the image to copy the video-link to the clipboard";var l=s("div",{id:"l3-7086-footer",class:"l3-7086-info"});l.innerHTML="v-".concat("0.5.2"),r.append(b),r.append(m),y.append(r),y.append(l),t.append(y),t.append(L);var u=s("style");u.innerHTML=N,document.body.append(u),document.body.append(t),t.addEventListener("click",C)}(),w&&(y.classList.add("open"),y.style.display="block",L.classList.add("open")),T&&2===T.length){var e=T.filter((function(n){return"single"===n.type}));P(e)}else""!==I?(h.value=I,h.dispatchEvent(new Event("input")),Z(I)):h.focus()}()}()}();